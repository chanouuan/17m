<!DOCTYPE html>
<html>
<head>
    <meta content="text/html; charset=UTF-8">
    <meta name="format-detection" content="telephone=no">
    <meta content="width=320, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <title></title>
    <meta name="keywords" content="">
    <meta name="description" content="">

    <link href="<?=$tpl_dir?>/yue/css/bootstrap.min.css?v=3.1" rel="stylesheet" type="text/css">
    <link href="<?=$tpl_dir?>/yue/css/common6.css" rel="stylesheet" type="text/css">

    <link href="<?=$tpl_dir?>/yue/css/notice.css?v=3.1" rel="stylesheet" type="text/css">
</head>
<body>

<div class="app">
    <div class="toolbar">
        <div class="toolbar-logo"><img src="<?=$tpl_dir?>/imgs/logo.png"></div>
        <div class="toolbar-menu" id="toolbar-menu"><a href="javascript:void(0)" data-role="icon-ment" class="icon-menu"></a></div>
        <div class="toolbar-back" id="toolbar-back"><a href="javascript:void(0);"><i class="icon-arrow-left"></i>上一步</a></div>
        <div class="toolbar-location" id="toolbar-location"><a href="javascript:void(0);"><i class="icon-location-white"></i><strong data-role="location"></strong><i data-role="arrow" class="icon-arrow-down"></i></a></div>

    </div>


    <div class="app-body">

        <div class="notice-wrap">
            <h2>欢迎来到天真蓝</h2>
            <div class="content">
                <dl class="notice-dl">
                    <dt>预约项目说明</dt>
                    <dd>
                        <ul class="intro">
                            <li>预约成功后订单不可更改，如需取消将产生订金损失，退款规则如下：
                                <p style="margin-top:6px;margin-bottom:8px;line-height: 1.4">
                                    距拍摄时间24小时以上取消订单，可退全额订金<br>
                                    距拍摄时间不足24小时取消订单，可退50%订金
                                </p>
                            </li>
                            <li>如未按预定日期到店，订单则视为放弃，全额订金的损失由预约方自行承担。</li>
                            <li>我们会提供精修后的.jpg格式底片，不提供原始拍摄文件。</li>
                            <li>除登记照和亲密照外，暂时仅支持单人预约，如需多人请分别预约。</li>
                        </ul>
                    </dd>
                </dl>

            </div>

            <div class="action" id="actionBox">


                <p style="font-size:1.2em;margin-top: 0;padding-top:0;padding-bottom:15px;color:#7CDFA8;" id="agreeWrapper">
                    <input type="checkbox" value="1" id="agreeCheckbox">
                    <b style="font-weight:bold;display: inline-block; background:white;">我同意上述条款</b>
                </p>


                <a href="javascript:void(0);" id="goBooking" class="nb-btn nb-btn-disable">开始预约</a>
                <a href="/user/orders" class="nb-btn nb-btn-default">我的订单</a>

                <h6 style="line-height: 1; color:#f6f6f6;">435030</h6>

            </div>
        </div>


        <div id="page-mask" class="page-mask"></div>
    </div>
</div>

<div id="toolbar-submenu" class="toolbar-submenu">
    <ul class="ts-menu" id="ts-menu">
        <li><a href="?c=marry&a=create"><i class="icon-order"></i>开始预约</a></li>
        <li><a href="?c=order&a=myorder"><i class="icon-orderlist"></i>我的订单</a></li>
        <li><a href="?c=order&a=Personal"><i class="icon-profile"></i>个人资料</a></li>
        <li><a href="?c=order&a=help"><i class="icon-notice"></i>拍摄须知</a></li>
    </ul>
    <div class="mask"></div>
</div>

<div id="alert-dialog" class="alert-dialog" style="display: none;">
    <div class="alert-box">
        <a href="javascript:$('#alert-dialog').hide();" class="close icon-close"></a>
        <div class="alert-header">
            <i class="icon-warning"></i>
        </div>
        <div class="alert-content">
        </div>
        <div class="alert-footer">
            <a href="javascript:void(0)" class="action-btn">好</a>
        </div>
    </div>
    <div class="mask"></div>
</div>

<script src="<?=$tpl_dir?>/yue/js/jQuery-2.1.4.min.js"></script>

<script>

    $('#toolbar-menu').click(function(){
        var mentEl = $(this).find('[data-role="icon-ment"]');
        $('#toolbar-submenu').toggle();
        if (mentEl.hasClass('icon-menu')) {
            mentEl.removeClass('icon-menu');
            mentEl.addClass('icon-arrow-right');
        } else {
            mentEl.addClass('icon-menu');
            mentEl.removeClass('icon-arrow-right');
        }

        setTimeout(function() {
            $('#ts-menu').toggleClass('ts-menu-active');
        }, 0);
    });


    $('#toolbar-back').click(function(){

        if($('#schedules-calender-open').length)
        {
            if(!$('#schedules-calender-open').hasClass('schedules-calender-open-show'))
            {
                $('#schedules-calender-open').addClass('schedules-calender-open-show');
                return ;
            }
        }

        history.back();
    });

    $('#toolbar-submenu').on('click', '.mask', function() {
        $('#toolbar-submenu').hide();
        var mentEl = $('#toolbar-menu').find('[data-role="icon-ment"]');
        if (mentEl.hasClass('icon-menu')) {
            mentEl.removeClass('icon-menu');
            mentEl.addClass('icon-arrow-right');
        } else {
            mentEl.addClass('icon-menu');
            mentEl.removeClass('icon-arrow-right');
        }
        $('#ts-menu').removeClass('ts-menu-active');
    });

</script>

<script src="//res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
<script>

    wx.config({
        appId: 'wx389960591722c05f',
        timestamp: '1567679775',
        nonceStr: 'b58skjs4hmtuisdc3jc73jcc3izv9lwk',
        signature: '44c68a0a51a1734a6b3244d7111c6856104f5253',
        jsApiList: ['getLocation']
    });


    //wait maximum 5 seconds for gps
    var gpsCheckTimeUp=false;
    setTimeout(function () {
        gpsCheckTimeUp=true;
    }, 6000);

    wx.ready(function(){
        console.log('getLocation: ');
        wx.getLocation({
            type: 'wgs84',
            success: function (res) {
                $.ajax({
                    url: '/api/book/store/gps?lat='+ res.latitude +'&lng='+ res.longitude,
                    type: 'GET',
                    timeout: 8000,
                    success: function(data) {
                        hasStore = data.hasStore;
                        city = data.city;
                        gpsCheckTimeUp=true;
                    },
                    error: function() {
                        gpsCheckTimeUp=true;
                    }
                });
            }
        });
    });


    function decideBtn()
    {
        setTimeout(function () {

            if($('#agreeCheckbox').is(':checked'))
                $('#goBooking').removeClass('nb-btn-disable').addClass('nb-btn-primary');
            else
                $('#goBooking').removeClass('nb-btn-primary').addClass('nb-btn-disable');

        }, 100);


    }

    $firstClick=false;
    $('#agreeWrapper').on('click', function() {

        if($firstClick)
            return ;

        $firstClick=true;
        // if(!$('#agreeCheckbox').is(':checked'))
        //     $('#agreeCheckbox').prop('checked',false).triggerHandler('click');
        //else
        $('#agreeCheckbox').prop('checked',true).triggerHandler('click');

        decideBtn();
    });



    $('#agreeCheckbox').on('click',function(){
        decideBtn();
    });





    var $simpleTextLoadingTimer;
    function simpleTextLoading($id, $prefix, $rear)
    {
        // List of words to loop on
        var words = ['...','','.', '..'];

        // Index of the words array
        var index = 0;

        $simpleTextLoadingTimer=window.setInterval(function(){
            $($id).html($prefix+words[index]+$rear);
            // Increment the index modulo the length of words: 0, 1, 2, 0, 1, 2, etc
            index = (index+1) % words.length;
        }, 500);
    }


    $('#goBooking').on('click', function() {

        if($(this).hasClass('nb-btn-disable'))
            return;


        if($(this).hasClass('validateTel'))
        {
            window.location.href = '/user/profile?action=validateTel';
            return ;
        }


        if(gpsCheckTimeUp!=true)
            simpleTextLoading('#goBooking','门店定位中','');
        //$(this).html('自动定位中...');

        //var times=1;
        var IntID = setInterval(function() {
            //times++;
            //console.log(times);
            if(gpsCheckTimeUp==true)
            {
                if(city != '')
                {
                    if (hasStore)
                        window.location.href = '/book/products?city=' + city;
                    else
                        window.location.href = '/book/city?city='+city;
                }
                else
                {
                    window.location.href = '/book/city?city=not-found';
                }

                clearInterval(IntID);
            }

        }, 300);

        // if (isAgreeClick) {
        //     return;
        // }
        //isAgreeClick = true;

    });

    $(function () {
        $('#actionBox').removeClass('softhide');
    });


</script>

</body></html>
